\subsection{DiauproMessage}

Die DiauproMessage Klasse verwaltet die Serialisierung und Deserialisierung von Daten zu, beziehungsweise von, Datagramm-Pakete. Die Datagramme selbst bestehen aus einer Header mit festen Länge, und Nutzdaten mit variable Länge, welche die Audio-, MIDI- und Zustanddaten enthält.\\
\\
Der Header wird wie folgt definiert:

\begin{lstlisting}
struct diapro_header {
    uint16 sequenceNumber;
    uint16 numSamples;
    uint16 numChannels;
    double sampleRate;
    uint16 audioDataSize;
    uint16 midiDataSize;
    uint16 stateDataSize;
    double cpuUsage;
};
\end{lstlisting}

Die DiaproMessage Klasse bemüht sich, bestehende zugewiesenen Speicher zu verwenden, wenn möglich. Instanzen DiauproMessage sollte nicht alloziert werden in den Thread, der die Audio-Verarbeitungsroutinen aufruft. Sie sollten lieber voralloziert werden mit genügend Speicher, um einen UPD Datagram mit maximale Größe (64 KB) zu speichern. Dieser Instanz soll dann für jeden Aufruf-Zyklus wiederverwendet werden damit Speicher nicht neu alloziert werden muss während der Zeit kritische Prozess.
