<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Distributed Audio Processing</title> 
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252"> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<!-- html,word,fn-in --> 
<meta name="src" content="main.tex"> 
<meta name="date" content="2015-10-26 13:45:00"> 
<link rel="stylesheet" type="text/css" href="main.css"> 
</head><body 
>
   <div class="maketitle">
                                                                  

                                                                  

<h2 class="titleHead">Distributed Audio Processing</h2>
     <div class="author" ><span 
class="ptmr7t-x-x-120">Alexander Gustafson</span>
<br /><span 
class="ptmr7t-x-x-120">University of Applied Sciences,</span>
<br />           <span 
class="ptmr7t-x-x-120">Z</span><span 
class="ptmr7t-x-x-120">&#x00FC;rich,</span>
<br />         <span 
class="ptmr7t-x-x-120">Switzerland,</span>
<br />   <span 
class="ptmr7t-x-x-120">alex</span><span 
class="ptmr7t-x-x-120">_gustafson@yahoo.de</span></div><br />
<div class="date" ><span 
class="ptmr7t-x-x-120">October 26, 2015</span></div>
                                                                  

                                                                  
   </div>
                                                                  

                                                                  
   <h2 class="likechapterHead"><a 
 id="x1-1000"></a>Abstract</h2> In modern profesional music studios, the computer has become responsible for
tasks that were previously performed by dedicated hardware. Mixing boards, effect
processors, dynamic compressors and equalizers, even the instruments themselves, are all
available as software. To alleviate the processing load on the CPU there is a growing
market for specialized DSP coprocessors which can process mutliple channels of
digital audio in realtime. These coprocessors are typically connected via Firewire or
PCIe and use multiple DSP chips for the processing. This project will examine an
inexpensive alternative based on standard Gigabit Ethernet and higher end Raspberry Pi
clones.
                                                                  

                                                                  
   <h2 class="likechapterHead"><a 
 id="x1-2000"></a>Contents</h2> <div class="tableofcontents">
   <span class="chapterToc" >1 <a 
href="#x1-30001" id="QQ2-1-3">Introduction</a></span>
<br />    <span class="sectionToc" >1.1 <a 
href="#x1-40001.1" id="QQ2-1-4">Ausgangslage</a></span>
<br />    <span class="sectionToc" >1.2 <a 
href="#x1-50001.2" id="QQ2-1-5">Ziel der Arbeit</a></span>
<br />    <span class="sectionToc" >1.3 <a 
href="#x1-60001.3" id="QQ2-1-6">Aufgabenstellung</a></span>
<br />   <span class="chapterToc" >2 <a 
href="#x1-70002" id="QQ2-1-7">Background</a></span>
<br />    <span class="sectionToc" >2.1 <a 
href="#x1-80002.1" id="QQ2-1-8">General Background</a></span>
<br />    <span class="sectionToc" >2.2 <a 
href="#x1-90002.2" id="QQ2-1-9">Realtime Audio Plugins</a></span>
<br />    <span class="sectionToc" >2.3 <a 
href="#x1-100002.3" id="QQ2-1-10">Audio Over Ethernet</a></span>
<br />    <span class="sectionToc" >2.4 <a 
href="#x1-110002.4" id="QQ2-1-11">Single Board Computers</a></span>
<br />    <span class="sectionToc" >2.5 <a 
href="#x1-120002.5" id="QQ2-1-12">Virtual Analog Synthesis</a></span>
<br />   <span class="chapterToc" >3 <a 
href="#x1-130003" id="QQ2-1-15">Requirements</a></span>
<br />    <span class="sectionToc" >3.1 <a 
href="#x1-140003.1" id="QQ2-1-16">General Requirements</a></span>
<br />    <span class="sectionToc" >3.2 <a 
href="#x1-150003.2" id="QQ2-1-17">Distributed Processing</a></span>
<br />    <span class="sectionToc" >3.3 <a 
href="#x1-160003.3" id="QQ2-1-21">Audio Plugin</a></span>
<br />    <span class="sectionToc" >3.4 <a 
href="#x1-170003.4" id="QQ2-1-22">Remote Processing Node</a></span>
<br />    <span class="sectionToc" >3.5 <a 
href="#x1-180003.5" id="QQ2-1-23">Software Requirements</a></span>
<br />     <span class="subsectionToc" >3.5.1 <a 
href="#x1-190003.5.1" id="QQ2-1-24">Evaluated C++ Frameworks</a></span>
<br />   <span class="chapterToc" >4 <a 
href="#x1-200004" id="QQ2-1-25">Implementation</a></span>
<br />    <span class="sectionToc" >4.1 <a 
href="#x1-210004.1" id="QQ2-1-26">Architecture</a></span>
<br />     <span class="subsectionToc" >4.1.1 <a 
href="#x1-220004.1.1" id="QQ2-1-28">Host CPU</a></span>
<br />     <span class="subsectionToc" >4.1.2 <a 
href="#x1-230004.1.2" id="QQ2-1-30">Networked SBCs</a></span>
<br />    <span class="sectionToc" >4.2 <a 
href="#x1-240004.2" id="QQ2-1-32">Software Components</a></span>
<br />     <span class="subsectionToc" >4.2.1 <a 
href="#x1-250004.2.1" id="QQ2-1-33">Socket Monitor</a></span>
<br />     <span class="subsectionToc" >4.2.2 <a 
href="#x1-260004.2.2" id="QQ2-1-34">ZeroconfManager</a></span>
<br />     <span class="subsectionToc" >4.2.3 <a 
href="#x1-270004.2.3" id="QQ2-1-35">DiauproMessage</a></span>
<br />     <span class="subsectionToc" >4.2.4 <a 
href="#x1-280004.2.4" id="QQ2-1-36">DiauproProcessor</a></span>
<br />     <span class="subsectionToc" >4.2.5 <a 
href="#x1-290004.2.5" id="QQ2-1-37">DiauproVCOProcessor</a></span>
<br />     <span class="subsectionToc" >4.2.6 <a 
href="#x1-300004.2.6" id="QQ2-1-38">DiauproVCAProcessor</a></span>
<br />     <span class="subsectionToc" >4.2.7 <a 
href="#x1-310004.2.7" id="QQ2-1-39">DiauproPlugin</a></span>
<br />   <span class="chapterToc" >5 <a 
href="#x1-320005" id="QQ2-1-41">Conclusion</a></span>
<br />    <span class="sectionToc" >5.1 <a 
href="#x1-330005.1" id="QQ2-1-42">Performance Evaluation</a></span>
<br />     <span class="subsectionToc" >5.1.1 <a 
href="#x1-340005.1.1" id="QQ2-1-43">Synchronous Performance</a></span>
<br />     <span class="subsectionToc" >5.1.2 <a 
href="#x1-350005.1.2" id="QQ2-1-46">Asynchronous Performance</a></span>
<br />     <span class="subsectionToc" >5.1.3 <a 
href="#x1-360005.1.3" id="QQ2-1-49">Potential Optimisations </a></span>
<br />    <span class="sectionToc" >5.2 <a 
href="#x1-370005.2" id="QQ2-1-50">Summary</a></span>
<br />   <span class="chapterToc" >6 <a 
href="#x1-380006" id="QQ2-1-51">Glossary</a></span>
                                                                  

                                                                  
<br />   <span class="chapterToc" >7 <a 
href="#x1-470007" id="QQ2-1-60">Appendix A</a></span>
<br />    <span class="sectionToc" >7.1 <a 
href="#x1-480007.1" id="QQ2-1-61">Compiling the Source Code</a></span>
<br />    <span class="sectionToc" >7.2 <a 
href="#x1-490007.2" id="QQ2-1-62">Bonjour</a></span>
<br />    <span class="sectionToc" >7.3 <a 
href="#x1-500007.3" id="QQ2-1-63">Evaluated Frameworks</a></span>
   </div>
                                                                  

                                                                  
   <h2 class="chapterHead"><span class="titlemark">Chapter 1</span><br /><a 
 id="x1-30001"></a>Introduction</h2>
   <h3 class="sectionHead"><span class="titlemark">1.1    </span> <a 
 id="x1-40001.1"></a>Ausgangslage</h3>
<!--l. 3--><p class="noindent" >20 years ago the CPU was just one component of a typical music studio. It was generally
used to control and synchronize other equipement such as mixing boards, multitrack
recorders, synthsizers and effects processors. Today all of the other equipement exists as
software, running in realtime on a CPU host. A typical music studio today is comprised of a
CPU, multiple analog to digital inputs and outputs, and some DSP equiped audio processing
cards.
<!--l. 5--><p class="indent" >   Simliar to GPU Cards which can accelerate graphics and visualization applications, audio
DSP cards can process multiple streams of high qualtiy digital audio, eliviating the load on
the CPU Host Computer. Audio DSP cards typically connect to the CPU via PCI, Firewire, or
Thunderbolt. Most vendors of DSP cards offer the possibility to connect several cards in
parallel to increase the processing capacity.
<!--l. 7--><p class="indent" >   Unlike GPU processors however, no open standard has evolved comparable to openGL or
openCL. 3D graphics applications profit enormously from the interoperability that openGL
offers. No such benefit is available for digital audio applications. Also, unlike OpenGL
applications, audio software that is developed to run on an audio DSP card cannot be run on
the CPU host. This results in vendor lock-in. The consumer that invests in an audio DSP card
and software, must continue to buy from the same vendor in order to build on the the
initial investment. If another vendor of DSP hardware creates a superior product, a
consumer is unlikely to switch platforms if a significant investment has already been
made.
<!--l. 9--><p class="indent" >   10 years ago this was an acceptable compromise because DSP processors connected via
PCIe could provide a significant performance increase. Today however, arm based
inexpensive CPUs connected via standard gigabit ethernet could offer a competitive
alternative.
<!--l. 11--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">1.2    </span> <a 
 id="x1-50001.2"></a>Ziel der Arbeit</h3>
<!--l. 13--><p class="noindent" >The purpose of this semester project is to design a software based music synthesiser that will
run on a network of low cost banana pi devices. Limitations in polyphony will be alleviated
by adding a new device to the network. In order to be compatible with existing music
recording and composition applications the software will include a VST Plugin that
allows music software to send MIDI commands to, and receive audio data from
the software. All data communication between the VST Plugin and the Banana PI
audio generation software will be handled via ethernet. The VST Plugin will send
control data information such as pitch, volume, length, and other expression data.
The Banana PI will stream back the generated audio data, as well as necessary
metadata so the VST plugin can properly collect and prepare the audio data for the host
software.
                                                                  

                                                                  
<!--l. 15--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">1.3    </span> <a 
 id="x1-60001.3"></a>Aufgabenstellung</h3>
     <ul class="itemize1">
     <li class="itemize">Anforderungsanalyse mit Priorit&#x00E4;tsbewertung
     </li>
     <li class="itemize">Vergleich von mehreren CPUs und Embedded Systems ( Banana Pi, Adapteva,
     Odroid) hinsichtlich ihrer Nutzbarkeit als Echtzeit Audioverarbeitungsmodule.
     Mit   dem   System,   das   die   Anforderungen   am   besten   erf&#x00FC;llt,   wird   die
     Implementierung gemacht.
     </li>
     <li class="itemize">Entwicklung der Audioverarbeitungssoftware in C ++.
     </li>
     <li class="itemize">Entwicklung eines VST-Plugins in C++, das als Schnittstelle zwischen g&#x00E4;ngigen
     Audio-Software und den Audioverarbeitungsmodule (pkt 3) dient.
     </li>
     <li class="itemize">Analyse  der  Implementierung,  um  die  N&#x00FC;tzlichkeit  und  Skalierbarkeit  zu
     bewerten.  Es  ergeben  sich  dadurch  verschiedene  Fragestellungen  wie  z.B.
     folgende: Kann die Leistung und Polyphonie durch Hinzuf&#x00FC;gen weiterer Module
     erh&#x00F6;ht werden, oder wird der Kommunikations-Overhead schlie&#x00DF;lich zu gross?
     </li></ul>
                                                                  

                                                                  
   <h2 class="chapterHead"><span class="titlemark">Chapter 2</span><br /><a 
 id="x1-70002"></a>Background</h2>
   <h3 class="sectionHead"><span class="titlemark">2.1    </span> <a 
 id="x1-80002.1"></a>General Background</h3>
<!--l. 3--><p class="noindent" >20 years ago one had to go to a recording studio to edit a music or audio recording. There
were large racks of equipment for various signal processing tasks. For example,
compressors and limiters to process the dynamic range, or reverb and echo effects to
give a track more ambience. 20 years ago the equipment needed for this kind of
processing filled large racks. Today all of these tasks run as software plugins on the
CPU.
<!--l. 6--><p class="indent" >   In 1996 Steinberg GmbH, the developers of Cubase, a popular audio production software
(or DAW, digital audio workstation), released the VST interface specification and SDK.<span class="cite"> [<a 
href="#XVST-wikipedia">10</a>]</span>
The VST plugin standard was special because it allowed realtime processing of audio in the
CPU and it allowed other developers to programm plugins which could be run from within
Cubase. The VST plugin standard quickly had widespread industry acceptance and was
adopted by competing DAWs. Although alternative standards exist, VST is still the most
widely adopted crossplatform standard.
<!--l. 8--><p class="indent" >   The number of realtime plugins that could run on a CPU was limited by several
factors, hard disc access speeds, bus speeds, amount of ram, and OS schedulers
for instance<span class="cite"> [<a 
href="#Xbrandt1998low">3</a>]</span>. User’s didn’t expect to be able to run more than 10 plugins at
a time. Simply playing back multiple tracks of digital audio in realtime was so
taxinig on the CPU that an application’s graphical interface would quickly become
unresponsive.
<!--l. 10--><p class="indent" >   Today it’s possible to playback hundreds of channels of audio and hundreds of plugins in
realtime. While the performance threshhold has risen, so have user expectations. The
algorithms driving today’s plugins are much more complex that those from 1996. Plugins are
available today that model acoustic systems or emulate the analog circutry of popular
vintage synthsizers. Even though CPU performance has increased significantly,
it’s still easy to reach the limits, especially with the more complex high qualtiy
plugins.
<!--l. 12--><p class="indent" >   Serval DSP based systems exist that can alleviate the load on the CPU much in the same
way that GPU accelerator cards work. Audio processing jobs are delegated to external
specialized hardware via PCIe or Thunderbolt interfaces. However, these DSP based
accelerators are proprietary and expensive. Developing plugins for a DSP chip is also
significatly more complex than developing for the CPU.
<!--l. 1--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">2.2    </span> <a 
 id="x1-90002.2"></a>Realtime Audio Plugins</h3>
<!--l. 3--><p class="noindent" >Music composition and production is typically done with the assistance of a digital audio
workstation (DAW) application. Midi events and audio recordings are arranged,
mixed, edited, and processed. In order to make changes undo-able edits are made in a
non-destructive fasion, calculated dynamically in realtime during audio playback. The
original audio data is always preserved. The user can change the parameters of an effect or
process in realtime and experiment with various parameters without fearing that the original
                                                                  

                                                                  
audio recording might be permenantly altered.
<!--l. 5--><p class="indent" >   A music sequencer or audio production application will usually include several built
in realtime effects that a user can apply to an audio track. In addition to the built
in options all professional applications will also be able to load 3d party effect
plugins. Depending on the platform and vendor one or several available plugin
standard will be implmeneted, the most common standard being Steinberg’s VST
standard.
<!--l. 7--><p class="indent" >   Regardless of the standard most audio plugins function in a similar fashion. The
host application will periodically poll the plugin via a callback, providing access
to the source audio data stream and expecting the plugin to return the processed
data.
<!--l. 9--><p class="indent" >   Audio plugins can also provide a gui to the user that allows processing parameters to be
modified, saved, and sequenced as well. This might be the cutoff frequency of a low pass
filter, or the delay time of a reverb effect, for example.
<!--l. 11--><p class="indent" >   From a programmer’s point of view audio plugins are always compiled as dynamically
loadable libraries that implement a standard’s specific API. The host DAW application can
load then at run time and stream audio data through them<span class="cite"> [<a 
href="#Xrealtime-architectures">6</a>]</span>.On the Windows platform VST
plugins are compiled to Dynamic Link Libraries, on Mac OSX they are Mach-O Bundles.
The native apple Audio Unit plugins are also compiled as Mach-O bundles, they have almost
identical functionality, but differ in their API implementation. Other alternative plugin
formats are Avid’s RTAS and AAX plugin formats, Microsoft’s DirectX architecture, or
LADSPA, DSSI and LV2 on Linux.
<!--l. 13--><p class="indent" >   Realtime Audio Plugins, as the name implies, must be able to complete their tasks fast
enough to comply with realtime audio requirements. How fast is fast enough? Well, that
depends how you define ”real time”. In audio applications, real time is defined in terms of an
audio system’s latency. The total delay between the time an audio signal enters the system (at
the analog to digital converter for example), is processed, and leaves the system (at the digital
to analog conterver) is the latency. The maximum acceptable latency is considered to be
around 10ms<span class="cite"> [<a 
href="#XAES67-2013">7</a>]</span>. Any higher and the latency becomes disturbing and not acceptable for live
performance applications.
<!--l. 15--><p class="indent" >   Any process will introduce some amount of delay. However within the audio
processing function, the programmer must take care not to introduce any unneccessary or
uncalculateable delays. It’s also important to understand that the audio processing function is
working in the context of a high-proirity system thread. Nothing in the process should have to
lock or wait for resources provided by other lower-priority threads. Examples of things to
avoid are memory allocations or deallocation, waiting or locking a mutex conditional
expressions inside loops that might break pipe-lining optimizations<span class="cite"> [<a 
href="#Xrealtime-architectures">6</a>]</span>, or updating the
graphic interface directly.
<!--l. 1--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">2.3    </span> <a 
 id="x1-100002.3"></a>Audio Over Ethernet</h3>
<!--l. 3--><p class="noindent" >Sending audio data over a network is not new. Sending audio data in ”realtime” is also
not new. The IETF (Internet Engineering Task Force) RFC 3550 Describes the
Real-time Transport Protocol for delivering audio and video in real-time over IP
                                                                  

                                                                  
networks. RTP is used as the basis of most media streaming and video conferencing
applications.
<!--l. 5--><p class="indent" >   Other  very  recent  specifications  such  as
AVB<a 
href="#fn1x3" id="fn1x3-bk"><span class="MsoFootnoteReference"><sup class="textsuperscript">1</sup></span></a><a 
 id="x1-10001f1"></a> and
AES67<a 
href="#fn2x3" id="fn2x3-bk"><span class="MsoFootnoteReference"><sup class="textsuperscript">2</sup></span></a><a 
 id="x1-10002f2"></a>
build on top of RTP and add more mechanisms to guarentee acurate timing and
synchronization across a network for professional audio applications. The synchronisation is
important in these standards because they are concerned with driving audio hardware
attached to different hosts on a network.
<!--l. 7--><p class="indent" >   Hardware synchronization is not relevent to this project because we are not concerned
with external audio hardware. The goal of this project it to utilise external CPUs as audio
coprocessors connected via gigabit Ethernet. Even so, the AVB and AES67 standards offer
many insights into how to optimize data transmission for low latency applications and they
also offer a proof-of-concept that it is possible. The AES67 defines guidelines that can
achieve latencies well below 1 ms for hundreds of simultaneos channels of high quality
audio. This is much faster than the legacy PCI and Firewire rates used in many DSP based
coprocessing systems<span class="cite"> [<a 
href="#Xbouillot2009aes">1</a>]</span>.
   <h3 class="sectionHead"><span class="titlemark">2.4    </span> <a 
 id="x1-110002.4"></a>Single Board Computers</h3>
<!--l. 3--><p class="noindent" >The popularity of the Raspberry Pi has spurned a whole industry around single-board
computers (SBCs). Based on hardware used in mobile phones, these small low power devices
are extremely popular because they are inexpensive and easy to use. The biggest advantage of
SBCs compared to other embeded devices ist that they can run the Android and Linux
operating systems, allowing them to be programmed using the same tools available on
desktop computers.
<!--l. 5--><p class="indent" >   Recent higher-end SBCs even come equiped with gigabit Ethernet and Dual and Quad
Core CPUs running at rates well over 1GHz. If we compare these systems to the 450MHz G3
PPC systems that the first VST Software was available for we can expect that the newer
high-end SBCs should be excellent audio coprocessors.
<!--l. 7--><p class="indent" >   2 SBCs are worth special consideration because they potentially offer even better
performance as audio coprocessors. The Parallella Board has a 16-Core Epiphany
co-processor that could be used to perform audio processing in parallel. Standard frameworks
such as OpenCL, MPI, or OpenMP can be used to target the Epiphany cores. The
Odroid-XU4 SBC includes a Mali-T628 GPU coprocessor which is also OpenCL compatible.
Both are available for under $100.
<!--l. 9--><p class="indent" >   Programming audio processing routines as OpenCL kernels might be considerably more
complex than in C++, but OpenCL offers vendor-independent access to GPGPU
computing and has the added benefit that it can also be used on a CPU without GPU
acceleration<span class="cite"> [<a 
href="#Xvst-gpu">5</a>]</span>.
<!--l. 11--><p class="indent" >   Investigating these, and other OpenCL enabled SBCs might be an interesting followup
project.
                                                                  

                                                                  
   <h3 class="sectionHead"><span class="titlemark">2.5    </span> <a 
 id="x1-120002.5"></a>Virtual Analog Synthesis</h3>
<!--l. 3--><p class="noindent" >Virtual analog synthesis is the term used to describe the emulation of analog synthsizers of
the 60s and 70s digitally in real time. The complexity and goals of an emulation can vary.
Some emulations go so far as to simulate the actual electronic components of vintage
synthesis circuits, others just model ths signal flow loosly.
<!--l. 5--><p class="indent" >   Regardless of the type of emulation, virtual analog systhesis has two primary concerns,
latency and aliasing. The problem of latency has already been described above. Any
processing will introduce a delay in the signal, the complexity of the processing can increase
the delay, or use more CPU cycles. Aliasing is audible distortion introduced by signals
that have a higher frequency content than the sampling rate of the system allows
for.
<!--l. 7--><p class="indent" >   Analog synthsizers usually employ subtractive synthsis. One or more sound generators or
oscillators would create signals with particular harmonic qualities. These signals are passed
through filters that ”subtract” frequencies from the signal. The oscillators, filters, and
amplitude can be modulated. Figure <a 
href="#x1-12001r1">2.1<!--tex4ht:ref: fig:synth_voice_block --></a> is a simple block diagram of a typical subtractive
synth voice.
<!--l. 9--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-12001r1"></a>
                                                                  

                                                                  
<!--l. 11--><p class="noindent" ><img 
src="main0x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main0x.png" src="assets/synth_voice_block.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 2.1: </span><span  
class="content">Block Diagram of a Subtractive Synthesis Voice</span></div><!--tex4ht:label?: x1-12001r1 -->
                                                                  

                                                                  
<!--l. 14--><p class="indent" >   </div><hr class="endfigure">
<!--l. 16--><p class="indent" >   The voltage controlled oscillators generate simple waveforms at the pitch coresponding
to the note played on the keyboard. The user can typically choose between some
combination of sawtooth, squareware, or triangle waveforms. The frequencies or
timbre of the waveforms can then be modulated by the following filter and amplitude
blocks.
<!--l. 18--><p class="indent" >   One’s first impression might be that modeling the oscillator would be simple. A
digitally generated squarewave or sawtooth waveform should be trivial to implement.
The 5kHz sawtooth waveform for example, would have a period of 8.82 samples
when generated in a 44.1kHz audio environment. So the waveform would increase
linearly from -1.0 to 1.0 over a length of 8.82 samples, then jump back to -1.0 and
cycle through again. What does 0.82 sample mean in a discreet digital system?
Figure <a 
href="#x1-12002r2">2.2<!--tex4ht:ref: fig:aliasing_sawtooth --></a> illustrates the problem with a trivial implementation. The left column
shows a portion of an idealized 5kHz sawtooth waveform and the corresponding
frequency content. Above the 5kHz fundamental frequency are harmonics that will be
audible well beyond 100kHz. The right column shows the same portion of a 5khz
sawtooth waveform in a 44.1kHz discrete environment. The waveform itself is distorted
and the higher harmonics are visible reflected back from the 22.05kHz nyquist
limit.
<!--l. 20--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-12002r2"></a>
                                                                  

                                                                  
<!--l. 22--><p class="noindent" ><img 
src="main1x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main1x.png" src="plots/graphics/sawtooth.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 2.2: </span><span  
class="content">Ideal and Aliased 5kHz Sawtooth waveform</span></div><!--tex4ht:label?: x1-12002r2 -->
                                                                  

                                                                  
<!--l. 25--><p class="indent" >   </div><hr class="endfigure">
<!--l. 27--><p class="indent" >   There are various methods to eliminate or reduce aliasing. The most effective is to
generate the harmonics using a series of sin waves up to the nyquist limit or half
of the system’s sampling rate, but this also very processing intensive. Less CPU
intensive strategies involve using oversampling, bandlimiting, or other alias-supressing
methods<span class="cite"> [<a 
href="#Xvirtual_analog_synthesis">9</a>]</span>.
                                                                  

                                                                  
   <h2 class="chapterHead"><span class="titlemark">Chapter 3</span><br /><a 
 id="x1-130003"></a>Requirements</h2>
   <h3 class="sectionHead"><span class="titlemark">3.1    </span> <a 
 id="x1-140003.1"></a>General Requirements</h3>
<!--l. 3--><p class="noindent" >The Application has two components, the audio plugin hosted on the main CPU machine,
and the processing nodes which run on networked SBC devices. The audio plugin
forwards midi control and audio data to the processing nodes. The nodes stream the
processed audio data back to the audio plugin, which in turn streams it back to
the host audio application. The total round-trip time, including processing, should
not exceed 10ms. This is the maxium allowed latency for live sound applications.
<span class="cite"> [<a 
href="#XAES67-2013">7</a>]</span>
<!--l. 5--><p class="indent" >   The application must be self contained and work without the user needing to install any system libraries,
frameworks or servers.<a 
href="#fn1x4" id="fn1x4-bk"><span class="MsoFootnoteReference"><sup class="textsuperscript">1</sup></span></a><a 
 id="x1-14001f1"></a>
   <h3 class="sectionHead"><span class="titlemark">3.2    </span> <a 
 id="x1-150003.2"></a>Distributed Processing</h3>
<!--l. 3--><p class="noindent" >In order to lighten the load of the host CPU we are interested in distributing real-time audio
processing jobs to remote CPUs connected by gigabit ethernet. On the host CPU an audio
plugin functions as the master node. To the host DAW, the distribution of jobs should be
completely transparent. The master node receives audio and control data from the host
application and returns the results just like any other audio plugin.
<!--l. 5--><p class="indent" >   In contrast to other distributed processing environments where large data sets are parceled
out to worker nodes, the plugin master is only given access to the audio data in small buffers
as it is needed. The plugin then has a very small amount of time to process the data and pass
it back to the host application. This puts some limits on how processing jobs can be
distributed.
<!--l. 7--><p class="indent" >   There are various degrees to which processing jobs can be distributed. Each plugin
instance could send it’s entire job to one networked node as in figure <a 
href="#x1-15001r1">3.1<!--tex4ht:ref: fig:one_to_one --></a>. Each processing
block in a plugin could send it’s partial job to a networked node as in figure <a 
href="#x1-15002r2">3.2<!--tex4ht:ref: fig:perproccessor --></a>. In the case of
a virtual synth plugin each voice performed could be distributed to it’s own node as in figure
 .
<!--l. 9--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-15001r1"></a>
                                                                  

                                                                  
<!--l. 11--><p class="noindent" ><img 
src="main2x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main2x.png" src="assets/distribution_1to1.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 3.1: </span><span  
class="content">Each Plugin Distributes to One Node</span></div><!--tex4ht:label?: x1-15001r1 -->
                                                                  

                                                                  
<!--l. 14--><p class="indent" >   </div><hr class="endfigure">
<!--l. 16--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-15002r2"></a>
                                                                  

                                                                  
<!--l. 18--><p class="noindent" ><img 
src="main3x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main3x.png" src="assets/distribution_perprocessor.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 3.2: </span><span  
class="content">Each Process Block Distributes to a Node</span></div><!--tex4ht:label?: x1-15002r2 -->
                                                                  

                                                                  
<!--l. 21--><p class="indent" >   </div><hr class="endfigure">
<!--l. 23--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-15003r3"></a>
                                                                  

                                                                  
<!--l. 25--><p class="noindent" ><img 
src="main4x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main4x.png" src="assets/distribute_byvoice.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 3.3: </span><span  
class="content">Each Synth Voice is Distributed to a Node</span></div><!--tex4ht:label?: x1-15003r3 -->
                                                                  

                                                                  
<!--l. 28--><p class="indent" >   </div><hr class="endfigure">
<!--l. 30--><p class="indent" >   For this project the second option will be implemented for the sake of testing, although it
might not be the most efficient implementation.
   <h3 class="sectionHead"><span class="titlemark">3.3    </span> <a 
 id="x1-160003.3"></a>Audio Plugin</h3>
<!--l. 3--><p class="noindent" >The plugin must appear to the host DAW application as a normal audio processing plugin,
managing the distribution of tasks to networked nodes internally. The audio plugin does not
run in an isolated environment. It will be running in tandem with its host application which
might be running any number of other plugins. Therefore every care should be made to
reduce it’s load on the CPU.
<!--l. 5--><p class="indent" >   Audio plugins typically have a state that will include parameter settings controlled by the
audio host or the user. This is important in order to allow an audio plugin to hand over an
on-going process to a newly connected node. It could also be used to allow a networked node
to be responsible for the processing of more that one audio plugin by switching it’s active
state accordingly.<br 
class="newline" /><br 
class="newline" />The audio plugin has the following requirements:
     <ul class="itemize1">
     <li class="itemize">runnable as a realtime VST audio plugin in a standard DAW application
     </li>
     <li class="itemize">locate and connect with one or more processing nodes on the network
     </li>
     <li class="itemize">forward midi and audio data from the host audio application to the networked
     nodes
     </li>
     <li class="itemize">receives audio data from the networked nodes and streams this back to the host
     application
     </li>
     <li class="itemize">in  the  absence  of  a  coressponding  node  on  the  network  perform  the  audio
     processing locally
     </li>
     <li class="itemize">the audio plugin must forward it’s current state to the node
     </li></ul>
<!--l. 1--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">3.4    </span> <a 
 id="x1-170003.4"></a>Remote Processing Node</h3>
                                                                  

                                                                  
<!--l. 3--><p class="noindent" >The processing nodes are applications that run on the networked SBC devices. Depending on
the type of parallelisation implemented in the audio plugin the processing nodes could be
delegated the entire processing job of the corresponding plugin or just a part of the job. For
this project the processing nodes will be implemented as a ”bank” of processors loaded into a
parent application. The parent application will implement a socket listener that
monitors an array of sockets for incoming requests, then call the callback of the node
that is responsible for that particular socket. The availability, type, and location
of node and it’s corresponding socket will be broadcasted over the network via
bonjour/zeroconf.
<!--l. 5--><p class="indent" >   The processing node should be stateless, each cycle of the audio processing algorithm
should only take the state data of the corresponding packet into account, and updates to the
state must be sent back as state data to the audio plugin. This is to ensure that if a node losses
connectivity the state can be retrieved and another node can take over. It also has the added
benefit that one processing node could be able to process jobs for several instances of a
particular plugin.<br 
class="newline" /><br 
class="newline" />The remote processing nodes have the following requirements:
     <ul class="itemize1">
     <li class="itemize">broadcasts its availability and location on the network via bonjour/zeroconf
     </li>
     <li class="itemize">accepts session initiated by the audio plugin
     </li>
     <li class="itemize">accepts controll data from the audio plugin
     </li>
     <li class="itemize">processes incoming audio data and midi data from the audio plugin
     </li>
     <li class="itemize">streams audio and midi data back to the audio plugin immediately
     </li></ul>
<!--l. 1--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">3.5    </span> <a 
 id="x1-180003.5"></a>Software Requirements</h3>
<!--l. 3--><p class="noindent" >In realtime audio applications timing is critical. This may sound obvious, but to a
programmer it means giving up many of the comforts of modern programming made
available working with high level interpreted languages such as java or python. Most audio
application interfaces and libraries such as the VST SDK are for C/C++.
<!--l. 5--><p class="indent" >   Professional audio applications generally run on Mac OSX or Windows Operating
Systems, therefore the audio plugin must be compatible on these systems. The processing
node will be run on SBC devices which typically run with a Linux based OS. Yet both
applications should share their codebase since there is alot of crossover of responsibility
between the audio plugin and the nodes.
                                                                  

                                                                  
<!--l. 7--><p class="indent" >   There are many C++ libraries and framework that address the issue of cross platform
compatibility while also giving the programmer access to high level constructs
like smart pointers and reference counted objects that make C++ programming
easier.
<!--l. 9--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">3.5.1    </span> <a 
 id="x1-190003.5.1"></a>Evaluated C++ Frameworks</h4>
<!--l. 11--><p class="noindent" >Boost is the most popular cross platform C++ frameworks. Many of it’s features have been
added to the C++11 standard library. Other frameworks like Cinder and Open Frameworks
offer many high level features to quickly build cross platform media rich interactive
applications. Two libraries of special note offer specific features to build cross platform
audio applications and plugins, JUCE and WDL. Of these two Juce has a much
larger community of users (including vendors of dsp based audio coprocessors).
<br 
class="newline" /><br 
class="newline" />Software Framework Criteria:
     <ul class="itemize1">
     <li class="itemize">Crossplatform for OSX, Linux, and Windows
     </li>
     <li class="itemize">Offers high level constructs like smart pointers
     </li>
     <li class="itemize">Support for crossplatform audio integration
     </li>
     <li class="itemize">Should be well documented and have an active community
     </li>
     <li class="itemize">Support for crossplatform network streaming
     </li></ul>
   <div class="table">
                                                                  

                                                                  
<!--l. 27--><p class="indent" >   <hr class="float"><div class="float" 
>
                                                                  

                                                                  
<div class="center" 
>
<!--l. 28--><p class="noindent" >
<div class="tabular"> <table id="TBL-2" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1"></colgroup><colgroup id="TBL-2-2g"><col 
id="TBL-2-2"></colgroup><colgroup id="TBL-2-3g"><col 
id="TBL-2-3"></colgroup><colgroup id="TBL-2-4g"><col 
id="TBL-2-4"></colgroup><colgroup id="TBL-2-5g"><col 
id="TBL-2-5"></colgroup><colgroup id="TBL-2-6g"><col 
id="TBL-2-6"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:wrap; text-align:left;" id="TBL-2-1-1"  
class="td11"><!--l. 31--><p class="noindent" >Framework                </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-1-2"  
class="td11"><!--l. 31--><p class="noindent" >High
Level
Utilities    </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-1-3"  
class="td11"><!--l. 31--><p class="noindent" >Audio
Utilities    </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-1-4"  
class="td11"><!--l. 31--><p class="noindent" >Network
Utilities    </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-1-5"  
class="td11"><!--l. 31--><p class="noindent" >VST
Utilities    </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-1-6"  
class="td11"><!--l. 31--><p class="noindent" >Community </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:wrap; text-align:left;" id="TBL-2-2-1"  
class="td11"><!--l. 33--><p class="noindent" >JUCE                          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-2-2"  
class="td11"><!--l. 33--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-2-3"  
class="td11"><!--l. 33--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-2-4"  
class="td11"><!--l. 33--><p class="noindent" >ja<a 
 id="fn2x4-bk"> <span class="MsoFootnoteReference"><sup class="textsuperscript">2</sup></span></a>             </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-2-5"  
class="td11"><!--l. 33--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-2-6"  
class="td11"><!--l. 33--><p class="noindent" >gross         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:wrap; text-align:left;" id="TBL-2-3-1"  
class="td11"><!--l. 34--><p class="noindent" >WDL                          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-3-2"  
class="td11"><!--l. 34--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-3-3"  
class="td11"><!--l. 34--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-3-4"  
class="td11"><!--l. 34--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-3-5"  
class="td11"><!--l. 34--><p class="noindent" >ja<a 
 id="fn3x4-bk"> <span class="MsoFootnoteReference"><sup class="textsuperscript">3</sup></span></a>             </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-3-6"  
class="td11"><!--l. 34--><p class="noindent" >klein         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-4-"><td  style="white-space:wrap; text-align:left;" id="TBL-2-4-1"  
class="td11"><!--l. 35--><p class="noindent" >Open Frameworks      </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-4-2"  
class="td11"><!--l. 35--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-4-3"  
class="td11"><!--l. 35--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-4-4"  
class="td11"><!--l. 35--><p class="noindent" >ja<a 
 id="fn4x4-bk"> <span class="MsoFootnoteReference"><sup class="textsuperscript">4</sup></span></a>             </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-4-5"  
class="td11"><!--l. 36--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-4-6"  
class="td11"><!--l. 36--><p class="noindent" >gross         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-5-"><td  style="white-space:wrap; text-align:left;" id="TBL-2-5-1"  
class="td11"><!--l. 37--><p class="noindent" >Boost                          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-5-2"  
class="td11"><!--l. 37--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-5-3"  
class="td11"><!--l. 37--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-5-4"  
class="td11"><!--l. 37--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-5-5"  
class="td11"><!--l. 37--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-5-6"  
class="td11"><!--l. 37--><p class="noindent" >gross         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-6-"><td  style="white-space:wrap; text-align:left;" id="TBL-2-6-1"  
class="td11"><!--l. 38--><p class="noindent" >Cinder                        </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-6-2"  
class="td11"><!--l. 38--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-6-3"  
class="td11"><!--l. 38--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-6-4"  
class="td11"><!--l. 38--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-6-5"  
class="td11"><!--l. 38--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-6-6"  
class="td11"><!--l. 38--><p class="noindent" >klein         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-7-"><td  style="white-space:wrap; text-align:left;" id="TBL-2-7-1"  
class="td11"><!--l. 39--><p class="noindent" >LibSourcey                 </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-7-2"  
class="td11"><!--l. 39--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-7-3"  
class="td11"><!--l. 39--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-7-4"  
class="td11"><!--l. 39--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-7-5"  
class="td11"><!--l. 39--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-7-6"  
class="td11"><!--l. 39--><p class="noindent" >nein          </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-8-"><td  style="white-space:wrap; text-align:left;" id="TBL-2-8-1"  
class="td11"><!--l. 40--><p class="noindent" >Qt                               </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-8-2"  
class="td11"><!--l. 40--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-8-3"  
class="td11"><!--l. 40--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-8-4"  
class="td11"><!--l. 40--><p class="noindent" >ja              </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-8-5"  
class="td11"><!--l. 40--><p class="noindent" >nein          </td><td  style="white-space:wrap; text-align:left;" id="TBL-2-8-6"  
class="td11"><!--l. 40--><p class="noindent" >gross         </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-2-9-"><td  style="white-space:wrap; text-align:left;" id="TBL-2-9-1"  
class="td11">               </td></tr></table></div></div>
                                                                  

                                                                  
   </div><hr class="endfloat" />
   </div>
<!--l. 46--><p class="indent" >   Based on the criteria comparison above and experience in previous projects JUCE was
chosen for this projects implementation.
                                                                  

                                                                  
   <h2 class="chapterHead"><span class="titlemark">Chapter 4</span><br /><a 
 id="x1-200004"></a>Implementation</h2>
   <h3 class="sectionHead"><span class="titlemark">4.1    </span> <a 
 id="x1-210004.1"></a>Architecture</h3>
<!--l. 3--><p class="noindent" >Figure <a 
href="#x1-21001r1">4.1<!--tex4ht:ref: fig:arch_01 --></a> illustrates a high level overview of the distributed audio proessing environment.
The user of the system interacts with the audio production software running on the host CPU
and can choose to activate an audio processing plugin on a specific audio track. A single
audio plugin might contain one or several individual processors. Processors that are enabled
for distributed processing will search for a corresponding processor on a network SBC
device.
<!--l. 5--><p class="indent" >   The devices are networked via gigabit ethernet. It is assumed that the network is not being
used for any other significant traffic.
<!--l. 7--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-21001r1"></a>
                                                                  

                                                                  
<!--l. 9--><p class="noindent" ><img 
src="main5x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main5x.png" src="assets/architecture_01.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 4.1: </span><span  
class="content">Architectural Overview</span></div><!--tex4ht:label?: x1-21001r1 -->
                                                                  

                                                                  
<!--l. 12--><p class="indent" >   </div><hr class="endfigure">
   <h4 class="subsectionHead"><span class="titlemark">4.1.1    </span> <a 
 id="x1-220004.1.1"></a>Host CPU</h4>
<!--l. 3--><p class="noindent" >Figure <a 
href="#x1-22001r2">4.2<!--tex4ht:ref: fig:arch_02 --></a> zooms in on the components involved in realtime audio on the CPU. The audio
hardware needs to provide a constant stream of data to it’s digital to analog converters. It does
this by periodically polling the operating system via hardware interrupts. The requested
buffer size can be as small as 32 samples and the polling intervals less than 1 ms depending
on the hardware and drivers.
<!--l. 5--><p class="indent" >   The operating system provides an abstraction layer in the form of an API to the
application software. This gives the application software a single API to interface with
regardless of the brand of audio hardware and drivers installed.
<!--l. 7--><p class="indent" >   The VST API is another abstraction layer that offers a unified interface for plugin
vendors, regardless of the OS. But VST is not the only plugin API. The Juce library offers it’s
own plugin API, which is simpler and abstracts away the differences between various plugin
APIs.
<!--l. 9--><p class="indent" >   The requests for data, manifested as interrupts triggered by the audio hardware, are
passed on through the system to the DAW application by means of callbacks that the
application has registered with the system. The DAW application in turn polls all the active
plugins for data through thier defined VST callback functions.
<!--l. 11--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-22001r2"></a>
                                                                  

                                                                  
<!--l. 13--><p class="noindent" ><img 
src="main6x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main6x.png" src="assets/architecture_02.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 4.2: </span><span  
class="content">Host CPU Overview</span></div><!--tex4ht:label?: x1-22001r2 -->
                                                                  

                                                                  
<!--l. 16--><p class="indent" >   </div><hr class="endfigure">
<!--l. 18--><p class="indent" >   The plugin implemented for this project has several network enabled processors, in figure
<a 
href="#x1-22001r2">4.2<!--tex4ht:ref: fig:arch_02 --></a> only one is shown as an example. When the plug in the instantiated by the host software,
it in turn instantiates each of it’s processors. The processors in turn immediately calls the
operating system’s Bonjour / Zeroconf daemon with a request to browse the network
for a specific service corresponding to a matching processor node. The request
includes a socket by which the daemon will notify the processor of machtes it has
found.
<!--l. 20--><p class="indent" >   The Bonjour / Zeroconf daemon notifies the audio plugin by means of the socket, at
which point the plugin’s Bonjour / Zeroconf manager scans through the list of matching
services to find on that is available. The plugins activeNode member holds a reference to the
matching network service.
<!--l. 22--><p class="indent" >   When a request for audio data is passed from the audio production software to the plugin,
it does so by calling the processBlock function of the plugin. The plugin in turn calls
the processBlock of each of its processors. In figure <a 
href="#x1-22001r2">4.2<!--tex4ht:ref: fig:arch_02 --></a> this is simplified showing
the processBlock of just a single processor. The processBlock function is given a
reference to the current audio buffer and midi buffer to process. The audio buffer
contains the individual samples for each channel to be processed as float values. The
midi buffer contains performance data including the timing and pitch of notes to be
played.
<!--l. 24--><p class="indent" >   Within the process block the processor checks if a activeNode is available. If so it
immediately forwards the buffers of audio and midi as well as it’s own state information to
the activeNode and awaits the response. When the response arrives the data is copied back to
the buffers. The audio production software continues to poll the following plugins until all
processing is complete. The resulting buffers are provided to the audio hardware, via the
HAL API services.
   <h4 class="subsectionHead"><span class="titlemark">4.1.2    </span> <a 
 id="x1-230004.1.2"></a>Networked SBCs</h4>
<!--l. 3--><p class="noindent" >Figure <a 
href="#x1-23001r3">4.3<!--tex4ht:ref: fig:arch_03 --></a> illustrates the components of the networked SBC devices. A processing
application can hold any number of processors that each register their services to the
Zeroconf / Bonjour daemon installed on the devices operating system. The Zeroconf /
Bonjour daemon broadcasts the availability, type and the port numbers of each of the
processors available.
<!--l. 5--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-23001r3"></a>
                                                                  

                                                                  
<!--l. 7--><p class="noindent" ><img 
src="main7x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main7x.png" src="assets/architecture_03.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 4.3: </span><span  
class="content">SBC Processor Overview</span></div><!--tex4ht:label?: x1-23001r3 -->
                                                                  

                                                                  
<!--l. 10--><p class="indent" >   </div><hr class="endfigure">
<!--l. 14--><p class="indent" >   The processor also registers an open socket and itself as that socket’s listener at the
appliation’s socket monitor module. The socket monitor holds an array of sockets and a
reference to each listener. It performs a select function on the array of sockets and
waits. When data arrives at any of the sockets, the select function is unblocked
and the socket monitor notifies the corresponding listener via callback that data is
available.
<!--l. 16--><p class="indent" >   The corresponding processor is notified via the callback function, it reads the
data, parses the audio and midi buffers, then perform a processBlock function on
the buffers. The results and updatad state information is that passed back to the
origin.
   <h3 class="sectionHead"><span class="titlemark">4.2    </span> <a 
 id="x1-240004.2"></a>Software Components</h3>
<!--l. 3--><p class="noindent" >The application is divided into modules that each manage their own responsibilities. Each
module was developed in a pseudo test-driven methodology. The tests were not necessarily
developed before the corresponding code was written, but definitely in conjunction thereof.
This resulted in stable code that could be tested in isolation from other components at every
code iteration.
<!--l. 5--><p class="indent" >   Where applicable, interaction with the class is defined in an associated ”listener” class
with specific callback methods that a client is expected to implement. A client class can then
inherit from and override the listener class.
<!--l. 1--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.2.1    </span> <a 
 id="x1-250004.2.1"></a>Socket Monitor</h4>
<!--l. 3--><p class="noindent" >The Monitor class was created to handle sockets efficiently. Client classes can implement the
FileDescriptorListener class can be extended by clients that wish to be notified when data is
available to read from on a specific socket.
<!--l. 5--><p class="indent" >   The Monitor class has a thread that blocks on a system select() call. The select is given an
array of sockets as file descriptors. When one of the sockets is ready to read from the select
call unblocks. The thread loops through the array to find the socket that is ready, and notifies
the corresponding listener.
<!--l. 7--><p class="indent" >   One of the sockets passed to the select() call is the Monitor’s own control_listener socket.
The Monitor class can send a signal to this socket when ever it need to wake the blocked
thread from the select() call and update it’s state. The Monitor class does this whenever a
new client registers or removes itself, and when the Monitor class needs to shut
down.
   <h4 class="subsectionHead"><span class="titlemark">4.2.2    </span> <a 
 id="x1-260004.2.2"></a>ZeroconfManager</h4>
<!--l. 3--><p class="noindent" >Zeroconf (short for Zero Configuration Network and also know as Bonjour on OSX ) is a
specification that allows services to broadcast their availability and location on a network.
Printer and Multimedia devices use Zeroconf in order to allow networked computers to easily
                                                                  

                                                                  
find and use their services.
<!--l. 5--><p class="indent" >   Bonjour on OSX and the compatibile features implemented by Avahi on Linux define a
callback based API that interfaces to a bonjour or avahi daemon running on the OS. The
Bonjour API is in C. The ZeroConfManager class encapsulates communication to the bonjour
or avahi deamon in an object oriented manner. Clients that want to interface with this class
must extend and override the ZeroConfListener class, they register themselves with the
ZeroConfManager..
<!--l. 7--><p class="indent" >   When new services are registered on the network, or removed from the network, the
corresponding listeners are notified with a list of all active services. If they are currently
connected with a service that is no longer available, it is the clienst responsibility to
disconnect from that service.
<!--l. 9--><p class="indent" >   In order to resolve a service to a specific IP address and port number several
asynchronous calls must be made to the Bonjour daemon, saving and updating the state of
each result between calls. The ZeroConfManager hides this complexity from it’s clients and
only notifies them when all the information is complete.
<!--l. 1--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.2.3    </span> <a 
 id="x1-270004.2.3"></a>DiauproMessage</h4>
<!--l. 3--><p class="noindent" >The DiauproMessage class manages the serialisation and deserialisation of data to datagram
packets. The datagrams themselves are comprised of a fixed length header, and a varible
length payload that contains the audio, midi, and state information.<br 
class="newline" /><br 
class="newline" />The header is defined as follows:
   <!--l. 7-->
   <div class="lstlisting" id="listing-1"><span class="label"><a 
 id="x1-27001r1"></a></span><span 
class="ptmr7t-x-x-80">struct</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">diapro</span><span 
class="ptmr7t-x-x-80">_header</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">{</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27002r2"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">uint16</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">sequenceNumber</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27003r3"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">uint16</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">numSamples</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27004r4"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">uint16</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">numChannels</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27005r5"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">double</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">sampleRate</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27006r6"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">uint16</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">audioDataSize</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27007r7"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">uint16</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">midiDataSize</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27008r8"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">uint16</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">stateDataSize</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27009r9"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">double</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">cpuUsage</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27010r10"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">double</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">totalTime</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27011r11"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">double</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processTime</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27012r12"></a></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">uint32</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">tagNr</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-27013r13"></a></span><span 
class="cmsy-8">}</span><span 
class="ptmr7t-x-x-80">;</span>
   
   </div>
<!--l. 23--><p class="indent" >   The DiaproMessage class makes an effort to use existing allocated memory when
possible. Instances of DiauproMessage should not be created or allocated in the thread that
calls the audio processing routines. Instead an instance of the DiauproMessage should be
preallocated with enough memory to store the largest UPD Datagram possible ( 64 kilobytes
). The instance can be reused for each cycle and memory will not have to be reallocated
during timing critical processes.
<!--l. 1--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.2.4    </span> <a 
 id="x1-280004.2.4"></a>DiauproProcessor</h4>
<!--l. 3--><p class="noindent" >The DiauproProcessor class is the base class that other Processors should inherit from. The
DiauproProcessor inherits from the JUCE AudioProcessor class which encapsulates all the
functionality of various audio plugin formats. Classes that inherit from AudioProcessor can
be wrapped into a VST plugin directly.
<!--l. 5--><p class="indent" >   A class that inherits from DiauproProcessor must extend the localProcess and
getServiceTag functions. The localProcess function performs the audio processing.
                                                                  

                                                                  
getServiceTag returns a string that will be used to broadcast and browse for the specific
service on the network.
<!--l. 7--><p class="indent" >   Classes that inherit from DiauproProcessor can be instantiated and setup to run in the
audio plugin or in the processing node. When run as plugin code the will browse for
corresponding services on the network. If they dont find one then the localProcess function
will be used locally. It they do find a networked service on all incoming audio and midi data
will be forwarded to that service.
<!--l. 9--><p class="indent" >   When run in a processing node, classes that inherit from DiauproProcessor will register
themselves on the network and wait to incoming processing requests.
<!--l. 11--><p class="indent" >   Examples of classes that inherit from DiauproProcessor are DiauproVCOProcessor and
DiauproVCAProcessor, described below.
   <h4 class="subsectionHead"><span class="titlemark">4.2.5    </span> <a 
 id="x1-290004.2.5"></a>DiauproVCOProcessor</h4>
<!--l. 3--><p class="noindent" >The DiauproVCOProcessor extends the base DiauproProcessor and implements the oscillator
block of a virtual synthsizer. The only functions from DiauproProcessor that need to be
overridden are localProcess, getState, getStateSize, and getServiceTag.
<!--l. 5--><p class="indent" >   localProcess is implemented as follows: <!--l. 6-->
   <div class="lstlisting" id="listing-2"><span class="label"><a 
 id="x1-29001r1"></a><span 
class="ptmr7t-x-x-80">1</span></span><span 
class="ptmr7t-x-x-80">void</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">DiauproVCOProcessor</span><span 
class="ptmr7t-x-x-80">::</span><span 
class="ptmr7t-x-x-80">localProcess</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">AudioSampleBuffer</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">&amp;</span><span 
class="ptmr7t-x-x-80">buffer</span><span 
class="ptmr7t-x-x-80">,</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29002r2"></a><span 
class="ptmr7t-x-x-80">2</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">MidiBuffer</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">&amp;</span><span 
class="ptmr7t-x-x-80">midiMessages</span><span 
class="ptmr7t-x-x-80">,</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29003r3"></a><span 
class="ptmr7t-x-x-80">3</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">void</span><span 
class="cmsy-8">*</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">state</span><span 
class="ptmr7t-x-x-80">)</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29004r4"></a><span 
class="ptmr7t-x-x-80">4</span></span><span 
class="cmsy-8">{</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29005r5"></a><span 
class="ptmr7t-x-x-80">5</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">*</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">vco</span><span 
class="ptmr7t-x-x-80">_state</span><span 
class="cmsy-8">*</span><span 
class="ptmr7t-x-x-80">)</span><span 
class="ptmr7t-x-x-80">state</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29006r6"></a><span 
class="ptmr7t-x-x-80">6</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">int</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">sampleNr</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29007r7"></a><span 
class="ptmr7t-x-x-80">7</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">int</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">nextEventCount</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">-</span><span 
class="ptmr7t-x-x-80">1;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29008r8"></a><span 
class="ptmr7t-x-x-80">8</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">MidiBuffer</span><span 
class="ptmr7t-x-x-80">::</span><span 
class="ptmr7t-x-x-80">Iterator</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">midiEventIterator</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">midiMessages</span><span 
class="ptmr7t-x-x-80">);</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29009r9"></a><span 
class="ptmr7t-x-x-80">9</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">MidiMessage</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">nextEvent</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29010r10"></a><span 
class="ptmr7t-x-x-80">10</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">bool</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">hasEvent</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29011r11"></a><span 
class="ptmr7t-x-x-80">11</span></span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29012r12"></a><span 
class="ptmr7t-x-x-80">12</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">for</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">sampleNr</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">0;</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">sampleNr</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmmi-8">&#x003C;</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">buffer</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">getNumSamples</span><span 
class="ptmr7t-x-x-80">();</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">sampleNr</span><span 
class="ptmr7t-x-x-80">++)</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29013r13"></a><span 
class="ptmr7t-x-x-80">13</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">{</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29014r14"></a><span 
class="ptmr7t-x-x-80">14</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">if</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">nextMidiEventCount</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmmi-8">&#x003C;</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">sampleNr</span><span 
class="ptmr7t-x-x-80">)</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29015r15"></a><span 
class="ptmr7t-x-x-80">15</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">{</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29016r16"></a><span 
class="ptmr7t-x-x-80">16</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">hasEvent</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">midiEventIterator</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">getNextEvent</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">nextEvent</span><span 
class="ptmr7t-x-x-80">,</span><span 
class="ptmr7t-x-x-80">nextEventCount</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">)</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29017r17"></a><span 
class="ptmr7t-x-x-80">17</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">}</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29018r18"></a><span 
class="ptmr7t-x-x-80">18</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">if</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">hasEvent</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">&amp;&amp;</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">nextEventCount</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">==</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">sampleNr</span><span 
class="ptmr7t-x-x-80">)</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29019r19"></a><span 
class="ptmr7t-x-x-80">19</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">{</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29020r20"></a><span 
class="ptmr7t-x-x-80">20</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">if</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">nextEvent</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">isNoteOn</span><span 
class="ptmr7t-x-x-80">())</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29021r21"></a><span 
class="ptmr7t-x-x-80">21</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">{</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29022r22"></a><span 
class="ptmr7t-x-x-80">22</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">voice</span><span 
class="ptmr7t-x-x-80">_count</span><span 
class="ptmr7t-x-x-80">++;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29023r23"></a><span 
class="ptmr7t-x-x-80">23</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">frequency</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">MidiMessage</span><span 
class="ptmr7t-x-x-80">::</span><span 
class="ptmr7t-x-x-80">getMidiNoteInHertz</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">nextEvent</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">getNoteNumber</span><span 
class="ptmr7t-x-x-80">());</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29024r24"></a><span 
class="ptmr7t-x-x-80">24</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">double</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">cyclesPerSample</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">frequency</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">/</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">getSampleRate</span><span 
class="ptmr7t-x-x-80">();</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29025r25"></a><span 
class="ptmr7t-x-x-80">25</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">step</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">cyclesPerSample</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">*</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">2.0</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">*</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">double</span><span 
class="ptmr7t-x-x-80">_Pi</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29026r26"></a><span 
class="ptmr7t-x-x-80">26</span></span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29027r27"></a><span 
class="ptmr7t-x-x-80">27</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">}</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">else</span><span 
class="cmsy-8">{</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29028r28"></a><span 
class="ptmr7t-x-x-80">28</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">voice</span><span 
class="ptmr7t-x-x-80">_count</span><span 
class="cmsy-8">-</span><span 
class="cmsy-8">-</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29029r29"></a><span 
class="ptmr7t-x-x-80">29</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">}</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29030r30"></a><span 
class="ptmr7t-x-x-80">30</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">}</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29031r31"></a><span 
class="ptmr7t-x-x-80">31</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">if</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">voice</span><span 
class="ptmr7t-x-x-80">_count</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmmi-8">&#x003E;</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">0)</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29032r32"></a><span 
class="ptmr7t-x-x-80">32</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">{</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29033r33"></a><span 
class="ptmr7t-x-x-80">33</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">const</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">float</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">currentSample</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">float</span><span 
class="ptmr7t-x-x-80">)</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">sin</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">phase</span><span 
class="ptmr7t-x-x-80">)</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">*</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">level</span><span 
class="ptmr7t-x-x-80">);</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29034r34"></a><span 
class="ptmr7t-x-x-80">34</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">phase</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">+=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">processState</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">step</span><span 
class="ptmr7t-x-x-80">;</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29035r35"></a><span 
class="ptmr7t-x-x-80">35</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">for</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">int</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">i</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">0;</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">i</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmmi-8">&#x003C;</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">buffer</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">getNumChannels</span><span 
class="ptmr7t-x-x-80">();</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">i</span><span 
class="ptmr7t-x-x-80">++)</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29036r36"></a><span 
class="ptmr7t-x-x-80">36</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">{</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29037r37"></a><span 
class="ptmr7t-x-x-80">37</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">float</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">oldSample</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">=</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">buffer</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">getSample</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">i</span><span 
class="ptmr7t-x-x-80">,</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">sampleNr</span><span 
class="ptmr7t-x-x-80">);</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29038r38"></a><span 
class="ptmr7t-x-x-80">38</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">buffer</span><span 
class="ptmr7t-x-x-80">.</span><span 
class="ptmr7t-x-x-80">setSample</span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">i</span><span 
class="ptmr7t-x-x-80">,</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">sampleNr</span><span 
class="ptmr7t-x-x-80">,</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">(</span><span 
class="ptmr7t-x-x-80">currentSample</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">+</span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80">oldSample</span><span 
class="ptmr7t-x-x-80">)</span><span 
class="cmsy-8">*</span><span 
class="ptmr7t-x-x-80">0.5);</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29039r39"></a><span 
class="ptmr7t-x-x-80">39</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">}</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29040r40"></a><span 
class="ptmr7t-x-x-80">40</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">}</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29041r41"></a><span 
class="ptmr7t-x-x-80">41</span></span><span 
class="ptmr7t-x-x-80"> </span><span 
class="ptmr7t-x-x-80"> </span><span 
class="cmsy-8">}</span><span 
class="ptmr7t-x-x-80"> </span><br /><span class="label"><a 
 id="x1-29042r42"></a><span 
class="ptmr7t-x-x-80">42</span></span><span 
class="cmsy-8">}</span>
   
   </div>
<!--l. 51--><p class="noindent" >When the function is called it is passed a reference to the current audio sample buffer to be
filled, a buffer of midi events for the corresponding time frame, and a pointer to a
block of data that can be used to hold and state that needs to be persisted between
calls.
<!--l. 54--><p class="indent" >   If this function is called from a node processor then the audio, midi, and state data has
been extracted from a DiauproMessage sent as a UDP packet from the master audio
plugin.
<!--l. 56--><p class="indent" >   In the example above a sin wave is create by calculating the sin value for each element in
the audio sample buffer.
   <h4 class="subsectionHead"><span class="titlemark">4.2.6    </span> <a 
 id="x1-300004.2.6"></a>DiauproVCAProcessor</h4>
<!--l. 3--><p class="noindent" >The DiauproVCAProcessor modulates the amplitude of a signal over time. VCA is short for
Voltage Controlled Amplifier, this referes to the processing block in a virtual synthsizer that
is responsible for the ”shape” of a sound. A bell sound, for instance, will have a fast
and loud initial tone that gradually decays to silence over a long period of time. In
contrast, a bowed string sound, like a violin, might have a slow rising initial tone
that suddenly ends. The VCA is responsible for the shaping of the amplitude of a
sound.
<!--l. 1--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">4.2.7    </span> <a 
 id="x1-310004.2.7"></a>DiauproPlugin</h4>
                                                                  

                                                                  
<!--l. 3--><p class="noindent" >The DiauproPlugin is the plugin that runs in the host DAW application. It passes audio data
from the host DAW application to three internall processors. The first processor is a ”Null
Process Block” that does no actual audio processing but is usefull for gathering data
regarding timing. The second processor is the VCO block that generates a tone based on
recieved midi data. The third block is the VCA that shapes the amplitude of the tone over
time.
<!--l. 5--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-31001r4"></a>
                                                                  

                                                                  

<!--l. 7--><p class="noindent" ><img 
src="assets/plugin.png" alt="PIC"  
>
<br /> <div class="caption" 
><span class="id">Figure 4.4: </span><span  
class="content">Screenshot of Plugin GUI</span></div><!--tex4ht:label?: x1-31001r4 -->
                                                                  

                                                                  
<!--l. 10--><p class="indent" >   </div><hr class="endfigure">
<!--l. 12--><p class="indent" >   The audio plugin’s user interface provides feedback to the user regarding the time and
operation of the internal processors. Each processor can perform the calculations locally on
the CPU or send it’s data to a networked node to be processed. A ”Network Status” indicator
shows if a networked node is performing the processing. The total time that a processor
requires to perform it’s operations is displayed as the ”Round Trip Time”. The
”Process Time” displays the amount of time that a remote SBC required to perform the
processing.
<!--l. 14--><p class="indent" >   A button is provided that allows the user to switch to an asynchronous processing method.
When this is activated each process checks for the availability of the SBC’s response, but if it
is not yet available is does not wait. Instead the process simply returns empty data back to the
plugin. By the time the next buffer is requested by the DAW application the first response is
available and the processor can immediately return it without waiting. This method creates a
delay in the signal of one buffer cycle, but has the advantage the it does not block
the CPU while waiting. The delay can usually be compensated for in the DAW
application.
<!--l. 16--><p class="indent" >   In addition to providing a graphical user interface the plugin also saves timing data to a
text file.
                                                                  

                                                                  
   <h2 class="chapterHead"><span class="titlemark">Chapter 5</span><br /><a 
 id="x1-320005"></a>Conclusion</h2>
   <h3 class="sectionHead"><span class="titlemark">5.1    </span> <a 
 id="x1-330005.1"></a>Performance Evaluation</h3>
<!--l. 3--><p class="noindent" >An Audio Plugin runs in an environment with many other components, sharing CPU
resources. Processing of audio data must be completed within discrete time intervals dictated
by the audio hardware. Typical audio sampling frequencies are 44.1kHz, 48kHz, 88.2kHz and
96kHz. Using 44.1kHz as an example, this means that all the calculations required for a
single sample must be completed within 0,023 ms. Interrupts would be received from the
audio hardware at intervals of 0.023ms as well, and this would put too much of a
strain on the Operating System of the CPU though. Instead, requests for new audio
data are bundled into buffers of samples. The size of the buffers is a parameter
that the user can modify, it’s usually set at 512 samples, but can be as low as 16
samples.
<!--l. 5--><p class="indent" >   Increasing the buffer size, increases the amount of time that the CPU has to
process audio data. This introduces latency into the system though. A buffer size of
512 samples equates to a latency of 11.60ms. A 16 sample buffer size equates to
0.36ms.
<!--l. 7--><p class="indent" >   If a single plugin requires 1.0ms to complete its processing then it will not finish in time
if the buffer size is set too low. If the buffer size is just high enough, then there
still might not be enough CPU resources left for other plugins to complete their
tasks.
<!--l. 9--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">5.1.1    </span> <a 
 id="x1-340005.1.1"></a>Synchronous Performance</h4>
<!--l. 11--><p class="noindent" >This project offloads the processing external SBC devices. However, no resources are saved if
the audio plugin is blocked while it waits for the results from the SBC device. Since the
external SBC devices are slower than the main CPU, the processing time will take longer.
Adding the time it takes to serialise and deserialise the Datagram packet at each end will
degrade performance even more.
<!--l. 13--><p class="indent" >   Figure <a 
href="#x1-34001r1">5.1<!--tex4ht:ref: fig:local_vs_remote --></a> illustrates the problem in more detail.
<!--l. 15--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-34001r1"></a>
                                                                  

                                                                  
<!--l. 17--><p class="noindent" ><img 
src="main8x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main8x.png" src="assets/conclusion/process_flow_compared.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 5.1: </span><span  
class="content">Local vs Remote Synchronous Processing</span></div><!--tex4ht:label?: x1-34001r1 -->
                                                                  

                                                                  
<!--l. 20--><p class="indent" >   </div><hr class="endfigure">
<!--l. 22--><p class="indent" >   The example shows the audio hardware polling the operating system in intervals of 5.8
ms. This corresponds to a buffer size of 256 samples. The time interval between states D and
E represents the time it takes for a plugin to process a buffer of 256 sample. The DAW
performs other necessary audio processing functions in the interval between F and G. After
states G and H the DAW and OS are free to be able to do other things, like update the
GUI.
<!--l. 24--><p class="indent" >   With synchronous remote processing the state E is blocked until states 1 and 2 have
completed. If that time is significant then the ability of the DAW and the OS to perform other
critical tasks is impaired.
   <div class="table">
                                                                  

                                                                  
<!--l. 1--><p class="indent" >   <a 
 id="x1-34002r1"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
<div class="center" 
>
<!--l. 2--><p class="noindent" >
<div class="tabular"> <table id="TBL-3" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-3-1g"><col 
id="TBL-3-1"></colgroup><colgroup id="TBL-3-2g"><col 
id="TBL-3-2"></colgroup><colgroup id="TBL-3-3g"><col 
id="TBL-3-3"></colgroup><colgroup id="TBL-3-4g"><col 
id="TBL-3-4"></colgroup><colgroup id="TBL-3-5g"><col 
id="TBL-3-5"></colgroup><colgroup id="TBL-3-6g"><col 
id="TBL-3-6"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-1-"><td  style="white-space:wrap; text-align:left;" id="TBL-3-1-1"  
class="td11"><!--l. 5--><p class="noindent" >buffer
size          </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-1-2"  
class="td11"><!--l. 5--><p class="noindent" >limit (ms) </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-1-3"  
class="td11"><!--l. 5--><p class="noindent" >rtTime (ms)</td><td  style="white-space:wrap; text-align:left;" id="TBL-3-1-4"  
class="td11"><!--l. 5--><p class="noindent" >pTime (ms) </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-1-5"  
class="td11"><!--l. 5--><p class="noindent" >tTime (ms)</td><td  style="white-space:wrap; text-align:left;" id="TBL-3-1-6"  
class="td11"><!--l. 5--><p class="noindent" >% of limit</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-2-"><td  style="white-space:wrap; text-align:left;" id="TBL-3-2-1"  
class="td11"><!--l. 7--><p class="noindent" >64             </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-2-2"  
class="td11"><!--l. 7--><p class="noindent" >1.451247  </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-2-3"  
class="td11"><!--l. 7--><p class="noindent" >0.574672    </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-2-4"  
class="td11"><!--l. 7--><p class="noindent" >0.015857    </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-2-5"  
class="td11"><!--l. 7--><p class="noindent" >0.558815   </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-2-6"  
class="td11"><!--l. 7--><p class="noindent" >39.59       </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-3-"><td  style="white-space:wrap; text-align:left;" id="TBL-3-3-1"  
class="td11"><!--l. 8--><p class="noindent" >96 </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-3-2"  
class="td11"><!--l. 8--><p class="noindent" >2.176870 </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-3-3"  
class="td11"><!--l. 8--><p class="noindent" >0.575419 </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-3-4"  
class="td11"><!--l. 8--><p class="noindent" >0.015851 </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-3-5"  
class="td11"><!--l. 8--><p class="noindent" >0.559568 </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-3-6"  
class="td11"><!--l. 8--><p class="noindent" >26.43</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-4-"><td  style="white-space:wrap; text-align:left;" id="TBL-3-4-1"  
class="td11"><!--l. 9--><p class="noindent" >128           </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-4-2"  
class="td11"><!--l. 9--><p class="noindent" >2.902494  </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-4-3"  
class="td11"><!--l. 9--><p class="noindent" >0.59001      </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-4-4"  
class="td11"><!--l. 9--><p class="noindent" >0.016519    </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-4-5"  
class="td11"><!--l. 9--><p class="noindent" >0.573491   </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-4-6"  
class="td11"><!--l. 9--><p class="noindent" >20.32       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-5-"><td  style="white-space:wrap; text-align:left;" id="TBL-3-5-1"  
class="td11"><!--l. 10--><p class="noindent" >192           </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-5-2"  
class="td11"><!--l. 10--><p class="noindent" >4.353741  </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-5-3"  
class="td11"><!--l. 10--><p class="noindent" >0.67902      </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-5-4"  
class="td11"><!--l. 10--><p class="noindent" >0.019013    </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-5-5"  
class="td11"><!--l. 10--><p class="noindent" >0.660007   </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-5-6"  
class="td11"><!--l. 10--><p class="noindent" >15.59       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-6-"><td  style="white-space:wrap; text-align:left;" id="TBL-3-6-1"  
class="td11"><!--l. 11--><p class="noindent" >256           </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-6-2"  
class="td11"><!--l. 11--><p class="noindent" >5.804988  </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-6-3"  
class="td11"><!--l. 11--><p class="noindent" >0.707267    </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-6-4"  
class="td11"><!--l. 11--><p class="noindent" >0.020352    </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-6-5"  
class="td11"><!--l. 11--><p class="noindent" >0.686915   </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-6-6"  
class="td11"><!--l. 11--><p class="noindent" >12.18       </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-3-7-"><td  style="white-space:wrap; text-align:left;" id="TBL-3-7-1"  
class="td11"><!--l. 12--><p class="noindent" >512           </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-7-2"  
class="td11"><!--l. 12--><p class="noindent" >11.60997  </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-7-3"  
class="td11"><!--l. 12--><p class="noindent" >0.707905    </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-7-4"  
class="td11"><!--l. 12--><p class="noindent" >0.026348    </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-7-5"  
class="td11"><!--l. 12--><p class="noindent" >0.681557   </td><td  style="white-space:wrap; text-align:left;" id="TBL-3-7-6"  
class="td11"><!--l. 12--><p class="noindent" >6.097       </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-3-8-"><td  style="white-space:wrap; text-align:left;" id="TBL-3-8-1"  
class="td11">       </td></tr></table></div></div>
<br /><div class="caption" 
><span class="id">Table 5.1: </span><span  
class="content">Measured Times for Synchronous Processing</span></div><!--tex4ht:label?: x1-34002r1 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
   </div>
<!--l. 28--><p class="indent" >   Table <a 
href="#x1-34002r1">5.1<!--tex4ht:ref: tab:latency_comp --></a> shows the measured times for various buffer sizes for the synchronous
implementation that does no actually audio processing. Only the preparation transport
times are taken into account. An audio system running with a buffer size of 64
samples has 1.451ms to complete all tasks. ”rtTime” is the meassured total round trip
time. This corresponds to the time between states D and E of the Synchronous
Remote Process Flow diagram in Figure <a 
href="#x1-34001r1">5.1<!--tex4ht:ref: fig:local_vs_remote --></a>. ”pTime” is time interval between
states 1 and 2 on the SBC device, the time spent processing the data. In this case
there was no processing so this is only the measures the time spent deserialiseing
and serialising the datagrams into audio and midi data. ”tTime” is the ”rtTime”
subtracted by the ”pTime” and is the packaging overhead required to send and receive
data.
<!--l. 30--><p class="indent" >   The last column, ”% of limit”, shows how much time was spent in total as a percentage of
the limit. At a buffer size of 64 samples 39.59% percent of the total time available was
spent by a single plugin. This does not leave much time for other processes on the
CPU. For a buffer size of 512 samples the ”% of limit” value is much lower. The
total system latency is slightly higher that the stated 10ms maximum though. The
synchronous implementation has not reduced the processing load on the CPU at
all.
   <h4 class="subsectionHead"><span class="titlemark">5.1.2    </span> <a 
 id="x1-350005.1.2"></a>Asynchronous Performance</h4>
<!--l. 35--><p class="noindent" >Instead of waiting for a response from the SBC device, as in the synchronous method above,
the asynchronous method checks if a response is available. If so, return that data,
if not immediately return without data. The initial request for audio data would
return empty data, but by the time the second buffer is requested, the first respose
from the SBC device might have returned. In both cases the only time spent by the
audio plugin itself is the time is takes to serialise, deserialise, and transport the data.
These are the intervals between the states D and E and M and N represented in
figure <a 
href="#x1-35001r2">5.2<!--tex4ht:ref: fig:async_remote --></a>.
<!--l. 37--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-35001r2"></a>
                                                                  

                                                                  
<!--l. 39--><p class="noindent" ><img 
src="main9x.png" alt="PIC" class="graphics"><!--tex4ht:graphics  
name="main9x.png" src="assets/conclusion/async_flow.pdf"  
-->
<br /> <div class="caption" 
><span class="id">Figure 5.2: </span><span  
class="content">Local vs Remote Synchronous Processing</span></div><!--tex4ht:label?: x1-35001r2 -->
                                                                  

                                                                  
<!--l. 42--><p class="indent" >   </div><hr class="endfigure">
<!--l. 44--><p class="indent" >   By the time the second cycle begins (J in figure <a 
href="#x1-35001r2">5.2<!--tex4ht:ref: fig:async_remote --></a>) processed data from the first cycle
has returned. The time between events M and N is no longer proportional to the amount of
time needed to actually process the data, only to the time it takes for sending and receiving.
Table <a 
href="#x1-35002r2">5.2<!--tex4ht:ref: tab:latency_async --></a> shows the measured times.
   <div class="table">
                                                                  

                                                                  
<!--l. 1--><p class="indent" >   <a 
 id="x1-35002r2"></a><hr class="float"><div class="float" 
>
                                                                  

                                                                  
<div class="center" 
>
<!--l. 2--><p class="noindent" >
<div class="tabular"> <table id="TBL-4" class="tabular" 
cellspacing="0" cellpadding="0" rules="groups" 
><colgroup id="TBL-4-1g"><col 
id="TBL-4-1"></colgroup><colgroup id="TBL-4-2g"><col 
id="TBL-4-2"></colgroup><colgroup id="TBL-4-3g"><col 
id="TBL-4-3"></colgroup><colgroup id="TBL-4-4g"><col 
id="TBL-4-4"></colgroup><colgroup id="TBL-4-5g"><col 
id="TBL-4-5"></colgroup><colgroup id="TBL-4-6g"><col 
id="TBL-4-6"></colgroup><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-1-"><td  style="white-space:wrap; text-align:left;" id="TBL-4-1-1"  
class="td11"><!--l. 5--><p class="noindent" >buffer
size          </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-1-2"  
class="td11"><!--l. 5--><p class="noindent" >limit (ms) </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-1-3"  
class="td11"><!--l. 5--><p class="noindent" >rtTime (ms)</td><td  style="white-space:wrap; text-align:left;" id="TBL-4-1-4"  
class="td11"><!--l. 5--><p class="noindent" >pTime (ms) </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-1-5"  
class="td11"><!--l. 5--><p class="noindent" >tTime (ms)</td><td  style="white-space:wrap; text-align:left;" id="TBL-4-1-6"  
class="td11"><!--l. 5--><p class="noindent" >% of limit</td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-2-"><td  style="white-space:wrap; text-align:left;" id="TBL-4-2-1"  
class="td11"><!--l. 7--><p class="noindent" >64             </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-2-2"  
class="td11"><!--l. 7--><p class="noindent" >1.451247  </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-2-3"  
class="td11"><!--l. 7--><p class="noindent" >0.031683    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-2-4"  
class="td11"><!--l. 7--><p class="noindent" >0.015633    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-2-5"  
class="td11"><!--l. 7--><p class="noindent" >0.016050   </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-2-6"  
class="td11"><!--l. 7--><p class="noindent" >2.18         </td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-3-"><td  style="white-space:wrap; text-align:left;" id="TBL-4-3-1"  
class="td11"><!--l. 8--><p class="noindent" >96 </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-3-2"  
class="td11"><!--l. 8--><p class="noindent" >2.176870 </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-3-3"  
class="td11"><!--l. 8--><p class="noindent" >0.046585 </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-3-4"  
class="td11"><!--l. 8--><p class="noindent" >0.016076 </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-3-5"  
class="td11"><!--l. 8--><p class="noindent" >0.030509 </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-3-6"  
class="td11"><!--l. 8--><p class="noindent" >2.14</td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-4-"><td  style="white-space:wrap; text-align:left;" id="TBL-4-4-1"  
class="td11"><!--l. 9--><p class="noindent" >128           </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-4-2"  
class="td11"><!--l. 9--><p class="noindent" >2.902494  </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-4-3"  
class="td11"><!--l. 9--><p class="noindent" >0.034745    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-4-4"  
class="td11"><!--l. 9--><p class="noindent" >0.016712    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-4-5"  
class="td11"><!--l. 9--><p class="noindent" >0.018032   </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-4-6"  
class="td11"><!--l. 9--><p class="noindent" >1.19         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-5-"><td  style="white-space:wrap; text-align:left;" id="TBL-4-5-1"  
class="td11"><!--l. 10--><p class="noindent" >192           </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-5-2"  
class="td11"><!--l. 10--><p class="noindent" >4.353741  </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-5-3"  
class="td11"><!--l. 10--><p class="noindent" >0.052279    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-5-4"  
class="td11"><!--l. 10--><p class="noindent" >0.018800    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-5-5"  
class="td11"><!--l. 10--><p class="noindent" >0.033478   </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-5-6"  
class="td11"><!--l. 10--><p class="noindent" >1.20         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-6-"><td  style="white-space:wrap; text-align:left;" id="TBL-4-6-1"  
class="td11"><!--l. 11--><p class="noindent" >256           </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-6-2"  
class="td11"><!--l. 11--><p class="noindent" >5.804988  </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-6-3"  
class="td11"><!--l. 11--><p class="noindent" >0.065752    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-6-4"  
class="td11"><!--l. 11--><p class="noindent" >0.019646    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-6-5"  
class="td11"><!--l. 11--><p class="noindent" >0.046105   </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-6-6"  
class="td11"><!--l. 11--><p class="noindent" >1.13         </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-4-7-"><td  style="white-space:wrap; text-align:left;" id="TBL-4-7-1"  
class="td11"><!--l. 12--><p class="noindent" >512           </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-7-2"  
class="td11"><!--l. 12--><p class="noindent" >11.60997  </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-7-3"  
class="td11"><!--l. 12--><p class="noindent" >0.062939    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-7-4"  
class="td11"><!--l. 12--><p class="noindent" >0.019708    </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-7-5"  
class="td11"><!--l. 12--><p class="noindent" >0.043230   </td><td  style="white-space:wrap; text-align:left;" id="TBL-4-7-6"  
class="td11"><!--l. 12--><p class="noindent" >0.54         </td>
</tr><tr 
class="hline"><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td><td><hr></td></tr><tr  
 style="vertical-align:baseline;" id="TBL-4-8-"><td  style="white-space:wrap; text-align:left;" id="TBL-4-8-1"  
class="td11">       </td></tr></table></div></div>
<br /><div class="caption" 
><span class="id">Table 5.2: </span><span  
class="content">Measured Times for Asynchronous Processing</span></div><!--tex4ht:label?: x1-35002r2 -->
                                                                  

                                                                  
   </div><hr class="endfloat" />
   </div>
<!--l. 48--><p class="indent" >   In the table above ”rtTime” is no longer the actual round trip total processing time. Since
data is already available at the time the interrupt request is triggered, the plugin can
return it’s data immediately. This comes at the cost of a delay equal to one interrupt
cycle, but the user can set the audio system’s buffer size low enough that this is well
below the 10ms limit, without needing to use more than 1.2% of the processing time
available.
<!--l. 50--><p class="indent" >   The asynchronous method brings a real benefit to distributed processing in terms of
lighting the load on the CPU. The price of the benefit though is an increase in the latency of
the plugin. The processed audio data is always one delayed by one buffer cycle. Another
disadvantage is that if several distributed processors are chained in series, as is
the case in the demo application, then the latency is cumulative. This results in a
total latency that is the limit time multiplied by the number of processors in the
plugin.
   <h4 class="subsectionHead"><span class="titlemark">5.1.3    </span> <a 
 id="x1-360005.1.3"></a>Potential Optimisations </h4>
<!--l. 54--><p class="noindent" >There are two areas of the application where unnecessary operations are performed and could
be optimized. The first is the deserializsation of data when it is returned from the SBC. If
serveral processes in the Plugin are chained in series, then the returned DiauproMessage
could be sent directly to the following process without unnecessarily deserialising and the
reserialising the data in between steps. This would be a relatively simple optimization to
implement.
<!--l. 56--><p class="indent" >   The second optimisation is similar but more complicated to implement. In a chain to
processes the data would not need to be returned to the master plugin between each step,
instead it could be sent to the next node directly. If the next node is located on the same SBC
device then an additional hop over ethernet could be skipped as well. In addition serialisation
steps between nodes could also be skipped if the nodes performed the operations directly on
the data in the DiauproMessage. For this the DiauproMessage would need to be
extended to include routing information so that each node knows the next destination
point.
<!--l. 58--><p class="indent" >   Although more complex, the second optimization would have the added benefit that the
latency would no longer be a multiple of the full cycle time between interrupt calls. The final
data could be gathered after a single cycle.
<!--l. 60--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">5.2    </span> <a 
 id="x1-370005.2"></a>Summary</h3>
<!--l. 62--><p class="noindent" >The asynchronous implementation offers definite potential. The latency seems to be
inline with commercial DSP based systems<span class="cite"> [<a 
href="#XUAD2-review">8</a>]</span>. This is encouraging, especially
considering the expandability of the SBC based system, and the compatibilty of
the codebase. Two definite advantages that the SBC system has over DSP based
systems.
                                                                  

                                                                  
                                                                  

                                                                  
   <h2 class="chapterHead"><span class="titlemark">Chapter 6</span><br /><a 
 id="x1-380006"></a>Glossary</h2>
   <h4 class="likesubsectionHead"><a 
 id="x1-390006"></a>MIDI</h4>
<!--l. 4--><p class="noindent" >The Musical Instrument Digital Interface specification, first introduced in 1983 defines an
8-bit standard for encoding and transmitting music notes. It’s original purpose was to allow
one keyboard based synthesizer to controll other music devices.<span class="cite"> [<a 
href="#XBoulanger:2011">2</a>]</span> Allthough the
specification also describes the hardware and wiring for daisy chaining instruments in a midi
”network” most midi communication today transmitted via usb or virtually between audio
software.
<!--l. 6--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-400006"></a>Zeroconf</h4>
<!--l. 7--><p class="noindent" >Zeroconf is a network service discovery protocl. It is also known as Bonjour, and
occasionally refered to as Rendezvous, from the Apple implementations. Howl and Avahi are
alternative open source Zeroconf implementations for Linux. Application can use Zeroconf to
register or browse for service on a network without the need for a user to provide a specific IP
Adress or port number. <span class="cite"> [<a 
href="#Xzeroconf">4</a>]</span>
<!--l. 9--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-410006"></a>AES67</h4>
<!--l. 11--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-420006"></a>Latency</h4>
<!--l. 13--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-430006"></a>VST</h4>
<!--l. 14--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-440006"></a>SBC</h4>
<!--l. 15--><p class="noindent" >
   <h4 class="likesubsectionHead"><a 
 id="x1-450006"></a>AVB</h4>
                                                                  

                                                                  
   <h2 class="likechapterHead"><a 
 id="x1-460006"></a>Bibliography</h2>
    <div class="thebibliography">
    <p class="bibitem" ><span class="biblabel">
  [1]<span class="bibsp">   </span></span><a 
 id="Xbouillot2009aes"></a>Nicolas Bouillot, Elizabeth Cohen, Jeremy R. Cooperstock, Andreas Floros,
    Nuno  Fonseca,  Richard  Foss,  Michael  Goodman,  John  Grant,  Kevin  Gross,
    Steven Harris, Brent Harshbarger, Joffrey Heyraud, Lars Jonsson, John Narus,
    Michael Page, Tom Snook, Atau Tanaka, Justin Trieger, and Umberto Zanghieri.
    Aes  white  paper:  Best  practices  in  network  audio.      <span 
class="ptmri7t-">J.  Audio  Eng.  Soc</span>,
    57(9):729—741, 2009.
    </p>
    <p class="bibitem" ><span class="biblabel">
  [2]<span class="bibsp">   </span></span><a 
 id="XBoulanger:2011"></a>Richard Boulanger and Victor Lazzarini. <span 
class="ptmri7t-">The Audio Programming Book</span>. The
    MIT Press, 2011.
    </p>
    <p class="bibitem" ><span class="biblabel">
  [3]<span class="bibsp">   </span></span><a 
 id="Xbrandt1998low"></a>Eli  Brandt  and  Roger B  Dannenberg.    Low-latency  music  software  using
    off-the-shelf operating systems. 1998.
    </p>
    <p class="bibitem" ><span class="biblabel">
  [4]<span class="bibsp">   </span></span><a 
 id="Xzeroconf"></a>Stuart Cheshire and Daniel H. Steinberg.   <span 
class="ptmri7t-">Zero Configuration Networking:</span>
    <span 
class="ptmri7t-">The Definitive Guide</span>. O’Reilly Media, Inc., first edition edition, 2006.
    </p>
    <p class="bibitem" ><span class="biblabel">
  [5]<span class="bibsp">   </span></span><a 
 id="Xvst-gpu"></a>Wolfgang  Fohl  and  Julia  Dessecker.   Realtime  computation  of  a  vst  audio
    effect  plugin  on  the  graphics  processor.      In  <span 
class="ptmri7t-">CONTENT  2011,  The  Third</span>
    <span 
class="ptmri7t-">International Conference on Creative Content Technologies,</span>, pages 58—62, 2011.
    </p>
    <p class="bibitem" ><span class="biblabel">
  [6]<span class="bibsp">   </span></span><a 
 id="Xrealtime-architectures"></a>Vincent Goudard and Remy Muller.  Real-time audio plugin architectures, a
    comparative study. pages 10, 22, 9 2003.
    </p>
                                                                  

                                                                  
    <p class="bibitem" ><span class="biblabel">
  [7]<span class="bibsp">   </span></span>
    <a 
 id="XAES67-2013"></a>AES Standards Committee Gross, Kevin.  <span 
class="ptmri7t-">AES standard for audio applications</span>
    <span 
class="ptmri7t-">of networks - High-performance streaming audio-over-IP interoperability</span>. Audio
    Engineering Society, Inc., 60 East 42nd Street, New York, NY., US., 2013.
    </p>
    <p class="bibitem" ><span class="biblabel">
  [8]<span class="bibsp">   </span></span><a 
 id="XUAD2-review"></a>Hugh Robjohns.  Review : Universal audio apollo, 2012.  [Online; accessed
    06-August-2015].
    </p>
    <p class="bibitem" ><span class="biblabel">
  [9]<span class="bibsp">   </span></span><a 
 id="Xvirtual_analog_synthesis"></a>Vesa V&#x00E4;lim&#x00E4;ki and Antti Huovilainen.   Oscillator and filter algorithms for
    virtual analog synthesis. <span 
class="ptmri7t-">Computer Music Journal</span>, 30(2):pp. 19—31, 2006.
    </p>
    <p class="bibitem" ><span class="biblabel">
 [10]<span class="bibsp">   </span></span><a 
 id="XVST-wikipedia"></a>Wikipedia.   Virtual studio technology ˜ Wikipedia, the free encyclopedia,
    2015. [Online; accessed 05-August-2015].
</p>
    </div>
                                                                  

                                                                  
   <h2 class="chapterHead"><span class="titlemark">Chapter 7</span><br /><a 
 id="x1-470007"></a>Appendix A</h2>
   <h3 class="sectionHead"><span class="titlemark">7.1    </span> <a 
 id="x1-480007.1"></a>Compiling the Source Code</h3>
<!--l. 3--><p class="noindent" >Download the Juce C++ Library from GitHub
<!--l. 5--><p class="indent" >   github.com/julianstorer/JUCE
<!--l. 7--><p class="indent" >   Additionally download and install the DrowAudio Juce Module Extensions
<!--l. 9--><p class="indent" >   github.com/drowaudio/drowaudio.git
   <h3 class="sectionHead"><span class="titlemark">7.2    </span> <a 
 id="x1-490007.2"></a>Bonjour</h3>
<!--l. 3--><p class="noindent" >Instructions for installing bonjour:
<!--l. 5--><p class="indent" >   If bonjour / zeroconfig is not installed on the SBC device you will get a ”fatal error:
dns_sd.h: No such file or directory” error. You can fix this by installing the Avahi
library
<!--l. 8--><p class="indent" >   ./configure —prefix=/usr —enable-compat-libdns_sd —sysconfdir=/etc —localstatedir=/var
—disable-static —disable-mono —disable-monodoc —disable-python —disable-qt3
—disable-qt4 —disable-gtk —disable-gtk3 —enable-core-docs —with-distro=none
—with-systemdsystemunitdir=no
<!--l. 14--><p class="indent" >   Requirements: sudo apt-get install intltool sudo apt-get install libperl-dev sudo apt-get
install libgtk2.0-dev sudo apt-get install libgtk3.0-dev sudo apt-get install libgdbm-dev sudo
apt-get install libdaemon-dev
   <h3 class="sectionHead"><span class="titlemark">7.3    </span> <a 
 id="x1-500007.3"></a>Evaluated Frameworks</h3>
<!--l. 3--><p class="noindent" >WDL : http://www.cockos.com/wdl/ ( +iplug library ) <br 
class="newline" />Juce : http://www.juce.com <br 
class="newline" />Open Frameworks : http://openframeworks.cc <br 
class="newline" />Boost : http://www.boost.org <br 
class="newline" />Cinder : http://libcinder.org <br 
class="newline" />LibSourcey : http://sourcey.com/libsourcey/ <br 
class="newline" />Qt : http://www.qt.io <br 
class="newline" />
   <div class="footnotes"><!--l. 5--><p class="MsoFootnoteText">      <a 
href="#fn1x3-bk" id="fn1x3"><span class="MsoFootnoteReference">     <sup class="textsuperscript">1</sup> </span></a><span 
class="ptmr7t-x-x-80">Audio Video Bridging refers to a set of IEEE standards that allow time-synchronized low latency</span>
<span 
class="ptmr7t-x-x-80">streaming services</span>
<!--l. 5--><p class="MsoFootnoteText">        <a 
href="#fn2x3-bk" id="fn2x3"><span class="MsoFootnoteReference">      <sup class="textsuperscript">2</sup> </span></a><span 
class="ptmr7t-x-x-80">AES67,created by the Audio Engineering Society, defines standard that allow existing low latency</span>
<span 
class="ptmr7t-x-x-80">streaming systems to interoperate. AES67 does not define any new technologies but attempts to set a lowest common</span>
<span 
class="ptmr7t-x-x-80">denominator by which existing standards can be compatible.</span>
<!--l. 5--><p class="MsoFootnoteText">        <a 
href="#fn1x4-bk" id="fn1x4"><span class="MsoFootnoteReference">      <sup class="textsuperscript">1</sup> </span></a><span 
class="ptmr7t-x-x-80">The only exception might be ZeroConf/Bonjour on Linux or Windows. See Appendix</span>                   </div>
 
</body></html> 

                                                                  


